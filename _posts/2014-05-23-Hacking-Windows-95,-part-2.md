---           
layout: post
title: Hacking Windows 95, part 2
date: 2014-05-23 19:45:05 UTC
updated: 2014-05-23 19:45:05 UTC
comments: false
categories: cain crack pwl fluxay Hack ping of death windows95
---
<div style="">In the <a href="http://jumpespjump.blogspot.be/2014/02/hacking-windows-95-part-1.html" target="_blank">Hacking Windows 95, part 1</a> blog post, we covered that through a nasty bug affecting Windows 95/98/ME, the share password can be guessed in no time. In this article, I'm going to try to use this vulnerability to achieve remote code execution (with the help of publicly available tools only).<br/><br/>The first thing we can do when we have read access to the Windows directory through the share, is to locate all the *.pwl files on the c:\windows directory, copy them to your machine where Cain is installed, switch to Cracker tab, pwl files, load the pwl file, add username based on the filename, and try to crack it. If you can't crack it you might still try to add a .pwl file where you already know the password in the remote windows directory. Although this is a fun post-exploitation task, but still, no remote code execution. These passwords are useless without physical access.<br/><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/winxp_to_hack_win95-2014-05-08-16-59-10.png" imageanchor="1" src="https://z6543.github.io/_img/winxp_to_hack_win95-2014-05-08-16-59-10.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/winxp_to_hack_win95-2014-05-08-16-59-10.png" width="400"/></a></div><br/></div><div style="">One might think that after having a share password and user password, it is easy to achieve remote code execution. The problem is:</div><ul><li style="text-align: justify;">there is no "at" command (available since Windows 95 plus!)</li><li style="text-align: justify;">there is no admin share</li><li style="text-align: justify;">there is no RPC</li><li style="text-align: justify;">there is no named pipes</li><li style="text-align: justify;">there is no remote registry</li><li style="text-align: justify;">there is no remote service management</li></ul><div style="">If you think about security best practices, disabling unnecessary services is always the first task you should do. Because Windows 95 lacks all of these services, it is pretty much secure!<br/><br/>During my quest for a tool to hack Windows 95, I came across some pretty cool stuff:<br/><div><br/><b><a href="http://www.gregthatcher.com/InternetPeriscope/">Internet periscope</a></b><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/winxp_to_hack_win95-2014-05-08-17-06-52.png" imageanchor="1" src="https://z6543.github.io/_img/winxp_to_hack_win95-2014-05-08-17-06-52.png"><img border="0" height="" src="https://z6543.github.io/_img/winxp_to_hack_win95-2014-05-08-17-06-52.png" width="320"/></a></div><b><br/></b></div><div><b><a href="http://sourceforge.net/projects/winfingerprint/">Winfingerprint</a></b><br/><div class="separator" style=""></div><div class="separator" style=""><a href="https://z6543.github.io/_img/winfingerprint.png" imageanchor="1" src="https://z6543.github.io/_img/winfingerprint.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/winfingerprint.png" width="320"/></a></div><br/></div><div><b><a href="http://lantricks.com/download/">LanSpy</a></b><br/><div class="separator" style=""></div><div class="separator" style=""><a href="https://z6543.github.io/_img/lanspy.png" imageanchor="1" src="https://z6543.github.io/_img/lanspy.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/lanspy.png" width="290"/></a></div><br/>But the best of the best is <b><a href="http://download.csdn.net/detail/zheng127/4552709">Fluxay</a></b>, which has been written by chinese hackers. It is the metasploit from the year 2000. A screenshot is worth more than a 1000 words. 4 screenshot &gt; 4 thousand words :)<br/><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/fluxay1.png" imageanchor="1" src="https://z6543.github.io/_img/fluxay1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/fluxay1.png" width="320"/></a></div><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/fluxay2.png" imageanchor="1" src="https://z6543.github.io/_img/fluxay2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/fluxay2.png" width="320"/></a></div><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/fluxay3.png" imageanchor="1" src="https://z6543.github.io/_img/fluxay3.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/fluxay3.png" width="320"/></a></div><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/fluxay4.png" imageanchor="1" src="https://z6543.github.io/_img/fluxay4.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/fluxay4.png" width="320"/></a></div><br/></div><div>It is pretty hard to find the installer, but it is still out there!<br/><br/>But at the end, no remote code execution for me.</div></div><div style=""><br/></div><div style="">My idea here was that if I can find a file which executes regularly (on a scheduled basis), I can change that executable to my backdoor and I'm done. Although there is no scheduler in the default Windows 95, I gave it a try. </div><div style=""><br/></div><div style="">Let's fire up taskman.exe to get an idea what processes are running:<br/><br/></div><div class="separator" style=""><a href="https://z6543.github.io/_img/Windows+95-2014-01-07-21-18-47.png" imageanchor="1" src="https://z6543.github.io/_img/Windows+95-2014-01-07-21-18-47.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/Windows+95-2014-01-07-21-18-47.png" width="400"/></a></div><div style=""><br/></div><div style="">Looks like we need a more powerful tool here, namely Process Explorer. Let's try to download this from oldapps.com:<br/><br/></div><div class="separator" style=""><a href="https://z6543.github.io/_img/Windows+95-2014-02-02-12-12-30.png" imageanchor="1" src="https://z6543.github.io/_img/Windows+95-2014-02-02-12-12-30.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/Windows+95-2014-02-02-12-12-30.png" width="400"/></a></div><div style=""><br/></div><div style="">LOL, IE3 hangs, can't render the page. Copying files to the Win95 VM is not that simple, because there are no shared folders in Win95 VM. And you can't use pendrives either, Win95 can't handle USB (at least the retail version). After downloading the application with a newer browser from oldapps, let's start Process Explorer on the test Windows 95.<br/><br/></div><div class="separator" style=""><a href="https://z6543.github.io/_img/Windows+95-2014-01-07-21-32-15.png" imageanchor="1" src="https://z6543.github.io/_img/Windows+95-2014-01-07-21-32-15.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/Windows+95-2014-01-07-21-32-15.png" width="400"/></a></div><div style=""><br/>Don't try to download the Winsocks 2 patch from the official MS site, it is not there anymore, but you can download it from <a href="ftp://ftp.ema.fr/pub/pc/windows/securite/">other sites</a>. </div><div style=""><br/></div><div style="">Now let's look at the processes running:<br/><div class="separator" style=""></div><br/><div class="separator" style=""></div><div class="separator" style=""><a href="https://z6543.github.io/_img/procexp_running.png" imageanchor="1" src="https://z6543.github.io/_img/procexp_running.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/procexp_running.png" width="400"/></a></div><br/>After staring it for minutes, turned out it is constant, no new processes appeared.<br/>Looking at the next screenshot, one can notice this OS was not running a lot of background processes ...<br/><br/></div><div style=""><div class="separator" style=""><a href="https://z6543.github.io/_img/procexp2.png" imageanchor="1" src="https://z6543.github.io/_img/procexp2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/procexp2.png" width="400"/></a></div><br/></div><div style="">My current Win7 has 1181 threads and 84 processes running, no wonder it is slow as hell :)<br/><br/></div><div style="">We have at least the following options:</div><ol><li style="text-align: justify;">You are lucky and not the plain Windows 95 is installed, but Windows 95 Plus! The main difference here is that Windows 95 Plus! has built-in scheduler, especially the "at" command. Just overwrite a file which is scheduled to execution, and wait. Mission accomplished!</li><li style="text-align: justify;">Ping of death - you can crash the machine (no BSOD, just crash) with long (over 65535 bytes) ICMP ping commands, and wait for someone to reboot it. Just don't forget to put your backdoor on the share and add it to autoexec.bat before crashing it. </li><li style="text-align: justify;">If your target is a plain Windows 95, I believe you are out of luck. No at command, no named pipes, no admin share, nothing. Meybe you can try to fuzz port 137 138 139, and write an exploit for those. Might be even Ping of Death is exploitable?</li></ol><div style="">Let's do the first option, and hack Windows 95 plus!</div><div style="">Look at the cool features we have by installing Win95 Plus!<br/><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/win95plus_features.png" imageanchor="1" src="https://z6543.github.io/_img/win95plus_features.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/win95plus_features.png" width="320"/></a></div><div class="separator" style=""><br/></div><div class="separator" style="">Cool new boot splash screen!</div><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/win95_plus_boot.png" imageanchor="1" src="https://z6543.github.io/_img/win95_plus_boot.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/win95_plus_boot.png" width="320"/></a></div><div class="separator" style=""><br/></div><div class="separator" style="">But our main interest is the new, scheduled tasks!</div><br/><div class="separator" style=""><a href="https://z6543.github.io/_img/win95_scheduled_tasks.png" imageanchor="1" src="https://z6543.github.io/_img/win95_scheduled_tasks.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="" src="https://z6543.github.io/_img/win95_scheduled_tasks.png" width="320"/></a></div><br/>Now we can replace diskalm.exe with our backdoor executable, and wait maximum one hour to be scheduled.<br/><br/>Instead of a boring text based tutorial, I created a YouTube video for you. Based on the feedbacks on my previous tutorialz, it turned out I'm way too old, and can't do interesting tutorials. That's why I analyzed the cool skiddie videoz, and found that I have to do the followings so my vidz won't suck anymore:<br/><ul><li>use cool black windows theme</li><li>put meaningless performance monitor gadgets on the sidebar</li><li>use a cool background, something related with hacking and skullz</li><li>do as many opsec fails as possible</li><li>instead of captions, use notepad with spelling errorz</li><li>there is only one rule of metal: <a href="http://www.youtube.com/watch?v=Hreqn9j3PHI">Play it fuckin' loud!!!!</a></li></ul><div style=""><iframe allowfullscreen="" frameborder="0" height="480" src="//www.youtube-nocookie.com/embed/x5Yt5UjLR1w?rel=0" width="640"></iframe></div></div>